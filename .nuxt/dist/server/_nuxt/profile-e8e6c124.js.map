{"version":3,"file":"profile-e8e6c124.js","sources":["../../../../pages/profile.vue"],"sourcesContent":["<script setup>\nconst { locale } = useI18n();\nconst localePath = useLocalePath();\nconst useToast = useToastOpen();\nconst useToastTitle = useToastText();\n\ndefinePageMeta({\n    middleware: ['auth'],\n});\n\n\nconst isChanged = ref(false);\nconst isLogout = ref(false);\nconst genderOptions = useGenderOptions();\nconst user = useUserInfo();\nif (!user.value) await usePersonalData(locale.value);\n\nconst first_name = ref(user.value.first_name);\nconst last_name = ref(user.value.last_name);\nconst gender = ref(null);\nconst birth_date = ref(user.value.date_birthday ? user.value.date_birthday.split(\"-\").reverse().join(\".\") : null);\nconst phone_number = ref(numberWithSpaces(`+998${user.value.phone_number}`, false).replace(\"(\", \"\").replace(\")\", \"\"));\n\nconst oldBirthday = ref(user.value.date_birthday.split(\"-\").reverse().join(\".\"));\nconst oldGender = ref(null);\ngenderOptions.value.map((item, index) => {\n    if (item.value == user.value.gender) {\n        gender.value = index;\n        oldGender.value = index;\n    }\n})\n\n\nconst errorFirst = ref(false);\nconst errorLast = ref(false);\nconst errorGender = ref(false);\nconst errorBirth = ref(false);\n\nconst validate = (val = 'all') => {\n    if (val == 'first' || val == 'all') {\n        if (!first_name.value || first_name.value.trim().length < 3) errorFirst.value = true;\n        else errorFirst.value = false;\n    }\n\n    if (val == 'last' || val == 'all') {\n        if (!last_name.value || last_name.value.trim().length < 3) errorLast.value = true;\n        else errorLast.value = false;\n    }\n\n    if (val == 'gender' || val == 'all') {\n        if (gender.value == null) errorGender.value = true;\n        else errorGender.value = false;\n    }\n\n    if (val == 'birth' || val == 'all') {\n        if (!birth_date.value) errorBirth.value = true;\n        else if (birth_date.value.length == 10) {\n            const day = birth_date.value.substring(0, 2);\n            const month = birth_date.value.substring(3, 5);\n            const year = birth_date.value.substring(6, 10);\n            errorBirth.value = !isDateValid(year, month, day);\n        } else {\n            errorBirth.value = true;\n        }\n    }\n\n    if (first_name.value !== user.value.first_name || last_name.value !== user.value.last_name || gender.value !== oldGender.value || birth_date.value !== oldBirthday.value) {\n        isChanged.value = true;\n    } else isChanged.value = false;\n    return (!errorFirst.value && !errorLast.value && !errorGender.value && !errorBirth.value);\n}\n\nconst onGenderChange = (val) => {\n    gender.value = val;\n    errorGender.value = false;\n    validate('gender');\n};\n\nconst isDateValid = (dateStr) => {\n    const today = new Date();\n    const date = new Date(dateStr);\n    if (isNaN(date)) return false;\n\n    if (date.getTime() >= today.getTime()) return false;\n    if (date.getFullYear() < 1900) return false;\n\n    return true;\n}\n\nconst logout = () => {\n    useLogOut();\n    isLogout.value = false;\n    navigateTo(localePath(\"/\"));\n}\n\nconst handleFocus = () => { if (!phone_number.value) phone_number.value = \"+998 \" };\nconst handleBlur = () => { if (phone_number.value == '+998 ') phone_number.value = null };\n\n\nconst onSubmit = async () => {\n    let body = {};\n    if (first_name.value !== user.value.first_name) body.first_name = first_name.value;\n    if (last_name.value !== user.value.last_name) body.last_name = last_name.value;\n    if (gender.value !== oldGender.value) body.gender = gender.value + 1;\n    if (birth_date.value !== oldBirthday.value) body.date_birthday = birth_date.value.split(\".\").reverse().join(\"-\");\n\n    const access = useCookie(\"access\");\n    const { data } = await useMyFetch(`${locale.value}/auth/update-profile/`, {\n        method: \"PATCH\",\n        body: body,\n        headers: { 'Authorization': `Bearer ${access.value}` }\n    })\n\n    if (data.value) {\n        useToastTitle.value = \"toast.changed\";\n        user.value = data.value;\n        isChanged.value = false;\n        user.value.first_name = first_name.value;\n        user.value.last_name = last_name.value;\n        oldGender.value = gender.value;\n        oldBirthday.value = birth_date.value;\n    }\n    else useToastTitle.value = \"toast.error\";\n\n    useToast.value = true;\n}\n</script>\n\n<template>\n    <div>\n        <div class=\"container my-5 flex justify-center\">\n            <div class=\"bg-white max-w-[600px] w-full rounded-2xl p-4 lg:p-8 flex flex-col\">\n                <div class=\"flex justify-end\">\n                    <div @click=\"isLogout = true\"\n                        class=\"px-4 flex-center h-10 text-red text-sm leading-normal rounded-lg hover:bg-[#E5E9F0] active:bg-[#CCD3E1] cursor-pointer\">\n                        {{ $t(\"logout\") }}</div>\n                </div>\n                <form @submit.prevent class=\"flex flex-col gap-8\">\n                    <p class=\"text-darkBlue font-bold text-[32px] leading-normal text-center\">{{ $t(\"profile\") }}</p>\n                    <div class=\"flex flex-col gap-4\">\n                        <BaseInput placeholder=\"input.name\" v-model=\"first_name\" inputID=\"first-name\" type=\"text\"\n                            :error=\"errorFirst ? 'error.first' : null\" @on-blur=\"validate('first')\" />\n                        <BaseInput placeholder=\"input.surname\" v-model=\"last_name\" inputID=\"last-name\" type=\"text\"\n                            :error=\"errorLast ? 'error.last' : null\" @on-blur=\"validate('last')\" />\n                        <BaseDropdown :options=\"genderOptions\" placeholder=\"userGenderTitle\" :selected=\"gender\"\n                            @on-change=\"onGenderChange\" :error=\"errorGender ? 'error.gender' : null\" />\n                        <BaseInput placeholder=\"input.birth\" v-model=\"birth_date\" inputID=\"birth-date\" type=\"text\"\n                            :is-birth=\"true\" @on-blur=\"validate('birth')\" :error=\"errorBirth ? 'error.birth' : null\" />\n                        <BaseInput placeholder=\"input.phone\" v-model=\"phone_number\" inputID=\"phone-number\" type=\"tel\"\n                            @on-focus=\"handleFocus\" @on-blur=\"handleBlur\" />\n                        <div class=\"flex gap-2\">\n                            <img src=\"~/assets/icons/info.svg\" alt=\"info\">\n                            <p class=\"text-xs text-secondary leading-normal\">\n                                {{ $t(\"profileInfo\") }}\n                            </p>\n                        </div>\n                    </div>\n                    <div class=\"flex flex-col gap-4\">\n                        <BaseButton state=\"primary\" :is-disabled=\"!isChanged\" @click=\"onSubmit\" type=\"submit\">\n                            {{ $t(\"save\") }}\n                        </BaseButton>\n                        <NuxtLinkLocale to=\"/\">\n                            <BaseButton class=\"font-normal w-full\" state=\"secondary\">{{ $t(\"backMain\") }}</BaseButton>\n                        </NuxtLinkLocale>\n                    </div>\n                </form>\n            </div>\n        </div>\n\n        <Transition name=\"fade\" mode=\"out-in\">\n            <PageModal v-if=\"isLogout\" @close=\"isLogout = false\">\n                <template #body>\n                    <div\n                        class=\"fixed-center z-[99] bg-white rounded-2xl p-4 flex flex-col max-w-[393px] w-[calc(100%-32px)] md:w-full\">\n                        <div class=\"self-end w-6 h-6 flex-center cursor-pointer\" @click=\"isLogout = false\">\n                            <img src=\"~/assets/icons/close.svg\" alt=\"close\">\n                        </div>\n                        <div class=\"flex flex-col gap-8\">\n                            <p class=\"text-darkBlue font-bold text-2xl leading-normal text-center\">\n                                {{ $t(\"sureLogout\") }}\n                            </p>\n                            <div class=\"flex flex-col gap-4\">\n                                <BaseButton class=\"font-normal\" state=\"secondary\" @click=\"isLogout = false\">\n                                    {{ $t(\"cancel\") }}\n                                </BaseButton>\n                                <BaseButton state=\"red\" @click=\"logout\">{{ $t(\"logout\") }}</BaseButton>\n                            </div>\n                        </div>\n                    </div>\n                </template>\n            </PageModal>\n        </Transition>\n    </div>\n</template>\n"],"names":["_withAsyncContext"],"mappings":"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"}